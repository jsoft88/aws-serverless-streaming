version: "3.6"
services:
  fetcher:
    build:
      context: ../../binlog_fetcher/
      dockerfile: Dockerfile-integration
      args:
        - fetcher_env_db_username=python
        - fetcher_env_db_password=123456
        - fetcher_env_db_host="MySQL"
        - fetcher_env_db_port=3306
        - fetcher_env_kinesis_stream_name=${fetcher_env_kinesis_stream_name}
        - fetcher_env_capture_from_schema=${fetcher_env_capture_from_schema}
        - fetcher_env_capture_from_table=${fetcher_env_capture_from_table}
    depends_on:
      - "MySQL"
  MySQL:
    image: mysql:5.7
    ports:
      - '3306:3306'
    volumes:
      - /tmp:/var/lib/mysql:rw
      - ./sql:/tmp:ro
    command: mysqld --datadir=/var/lib/mysql --user=root --server-id=1 --log-bin=/var/lib/mysql/mysql-bin.log --binlog_do_db=test_db && mysql -u root < /tmp/init_scripts.sql

  PlainAlpine:
    image: alpine:latest
    command: a=$(cat ./sql/inserts.sql | tr -d '\n') && mysql -h "MySQL" -u python -p123456 -e "$a"
    depends_on:
      - "MySQL"
